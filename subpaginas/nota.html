<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nota</title>
    <link rel="stylesheet" href="../css/stylenota.css">
    <script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>
</head>
<body>

    <article class="nota">
        <div class="nota-header">
            <h1 id="nota-titulo"></h1>
            <p id="nota-descripcion"></p>
        </div>
        
        <img id="nota-imagen" class="nota-imagen" style="display: none;"/>

        <div class="nota-meta">
            <p id="nota-publicado-por"></p>
            <p id="nota-rol"></p>
            <p id="nota-fecha-publicacion"></p>
        </div>

        <div id="nota-contenido" class="nota-contenido"></div>
    </article>

    <script>
        async function loadMarkdown() {
            // Obtener el parámetro de la URL (ejemplo: nota.html?file=maximstore-revoluciona-su-gestión-junto-a-cambalache-technologies.md)
            const urlParams = new URLSearchParams(window.location.search);
            const fileName = urlParams.get("file");

            if (!fileName) {
                document.getElementById("nota-contenido").innerHTML = "<p>Error: No se especificó un archivo de nota.</p>";
                return;
            }

            try {
                // Cargar el archivo Markdown
                const response = await fetch(`/content/notas/${fileName}`);
                const text = await response.text();

                // Convertir el Markdown a HTML con Showdown.js
                const converter = new showdown.Converter();
                const html = converter.makeHtml(text);
                
                // Insertar contenido en la página
                document.getElementById("nota-contenido").innerHTML = html;

                // Extraer metadata
                const metadata = extractMetadata(text);
                document.getElementById("nota-titulo").textContent = metadata.titulo;
                document.getElementById("nota-descripcion").textContent = metadata.descripcion;
                document.getElementById("nota-publicado-por").textContent = "Publicado por: " + metadata.publicado_por;
                document.getElementById("nota-rol").textContent = "Rol: " + metadata.rol;
                document.getElementById("nota-fecha-publicacion").textContent = "Fecha de publicación: " + metadata.fecha_publicacion;

                if (metadata.imagen) {
                    const img = document.getElementById("nota-imagen");
                    img.src = metadata.imagen;
                    img.style.display = "block";
                }

            } catch (error) {
                document.getElementById("nota-contenido").innerHTML = `<p>Error al cargar la nota: ${error.message}</p>`;
            }
        }

        function extractMetadata(text) {
            const metadata = {};
            const lines = text.split("\n");

            // Buscar metadatos
            lines.forEach(line => {
                if (line.startsWith("titulo:")) {
                    metadata.titulo = line.replace("titulo:", "").trim();
                } else if (line.startsWith("descripcion:")) {
                    metadata.descripcion = line.replace("descripcion:", "").trim();
                } else if (line.startsWith("imagen:")) {
                    metadata.imagen = line.replace("imagen:", "").trim();
                } else if (line.startsWith("concepto:")) {
                    metadata.concepto = line.replace("concepto:", "").trim();
                } else if (line.startsWith("publicado_por:")) {
                    metadata.publicado_por = line.replace("publicado_por:", "").trim();
                } else if (line.startsWith("rol:")) {
                    metadata.rol = line.replace("rol:", "").trim();
                } else if (line.startsWith("fecha_publicacion:")) {
                    metadata.fecha_publicacion = line.replace("fecha_publicacion:", "").trim();
                }
            });

            return metadata;
        }

        loadMarkdown();
    </script>

</body>
</html>
